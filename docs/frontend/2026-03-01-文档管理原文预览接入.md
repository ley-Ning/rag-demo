# 2026-03-01 文档管理原文预览接入（前端）

主公，这次把文档管理里的“原文预览”链路接起来了，点一下就能看源文件。

## 1. 这次改了哪些文件

1. `frontend/src/app/(workspace)/documents/page.tsx`
2. `frontend/src/app/globals.css`
3. `frontend/src/app/api/_shared/proxy.ts`
4. `frontend/src/app/api/v1/documents/[documentId]/file/route.ts`

## 2. 实现细节（大白话）

### 2.1 文档管理新增“预览原文”按钮

- 每条文档操作区新增 `预览原文`。
- 点击后打开预览弹窗。

### 2.2 弹窗内嵌原文件

- 弹窗里用 `iframe` 加载：`/api/v1/documents/{id}/file`。
- 增加“新窗口打开”按钮，方便单独查看。
- 同域 BFF 路由代理后端文件流，浏览器会按文件类型展示。

### 2.3 BFF 新增二进制代理

- `proxy.ts` 新增 `proxyBinary`，用于透传文件流（content-type/content-disposition）。
- 新增路由：`/api/v1/documents/[documentId]/file`。

## 3. 小赵两轮思考

### 第一轮：先打通用户路径

- 文档列表里直接放入口，别让用户到处找。
- 弹窗看原文，交互上最省跳转。

### 第二轮：再兼容复杂格式

- `iframe` + 新窗口双通道：
  - 能嵌入就直接看；
  - 不能嵌入就新窗口打开。

## 4. 验证结果

已执行：

- `cd frontend && npm run build`

结果：

- 构建通过。
- 路由清单里已出现 `/api/v1/documents/[documentId]/file`。

## 5. 思维导图

```mermaid
mindmap
  root((前端原文预览))
    入口
      文档列表按钮
      预览原文
    展示
      弹窗iframe
      新窗口打开
    代理
      proxyBinary
      documents/[id]/file路由
    收益
      文档排查更直观
      分块与原文可对照
      减少下载-打开-返回的来回
```
